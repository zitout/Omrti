// pages/_document.js
import { Html, Head, Main, NextScript } from 'next/document'

export default function Document() {
  return (
    <Html lang="ar" dir="rtl">
      <Head>
        <meta charSet="UTF-8" />
        <meta name="description" content="حاسبة تقسيط العمرة - احسب تكلفة رحلة العمرة بالتقسيط" />
        <meta name="keywords" content="عمرة, تقسيط, حاسبة, العمرة بالتقسيط" />
        <link
          href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap"
          rel="stylesheet"
        />
      </Head>
      <body>
        <Main />
        <NextScript />
      </body>
    </Html>
  )
}

// pages/_app.js
import '@/styles/globals.css'
import { ChakraProvider } from '@chakra-ui/react'
import { AnimatePresence } from 'framer-motion'

function MyApp({ Component, pageProps }) {
  return (
    <ChakraProvider>
      <AnimatePresence mode="wait">
        <Component {...pageProps} />
      </AnimatePresence>
    </ChakraProvider>
  )
}

export default MyApp

// styles/globals.css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --primary-color: #23a6d5;
    --secondary-color: #23d5ab;
    --accent-color: #e73c7e;
  }
  
  body {
    @apply min-h-screen font-tajawal bg-gradient-to-br from-[#ee7752] via-[var(--accent-color)] to-[var(--secondary-color)];
  }
}

// tailwind.config.js
module.exports = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx}',
    './components/**/*.{js,ts,jsx,tsx}',
  ],
  theme: {
    extend: {
      fontFamily: {
        tajawal: ['Tajawal', 'sans-serif'],
      },
      animation: {
        gradient: 'gradient 15s ease infinite',
      },
      keyframes: {
        gradient: {
          '0%': { backgroundPosition: '0% 50%' },
          '50%': { backgroundPosition: '100% 50%' },
          '100%': { backgroundPosition: '0% 50%' },
        },
      },
    },
  },
  plugins: [],
}

// components/Layout.js
import { motion } from 'framer-motion'
import ParticlesBackground from './ParticlesBackground'

export default function Layout({ children }) {
  return (
    <div className="relative min-h-screen flex flex-col justify-center items-center p-8">
      <ParticlesBackground />
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        exit={{ opacity: 0, y: -20 }}
        className="relative z-10 w-full max-w-2xl"
      >
        {children}
      </motion.div>
    </div>
  )
}

// components/ParticlesBackground.js
import { useCallback } from 'react'
import Particles from 'react-particles'
import { loadFull } from 'tsparticles'

export default function ParticlesBackground() {
  const particlesInit = useCallback(async (engine) => {
    await loadFull(engine)
  }, [])

  return (
    <Particles
      className="absolute inset-0"
      init={particlesInit}
      options={{
        particles: {
          number: { value: 80 },
          color: { value: '#ffffff' },
          opacity: { value: 0.5 },
          size: { value: 3 },
          move: { enable: true, speed: 6 },
          links: {
            enable: true,
            distance: 150,
            color: '#ffffff',
            opacity: 0.4,
            width: 1,
          },
        },
        interactivity: {
          events: {
            onHover: { enable: true, mode: 'repulse' },
            onClick: { enable: true, mode: 'push' },
          },
        },
      }}
    />
  )
}
   // styles/globals.css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --primary-color: #23a6d5;
    --secondary-color: #23d5ab;
    --accent-color: #e73c7e;
  }
}

@layer components {
  .gradient-animate {
    @apply bg-gradient-to-r from-[#ee7752] via-[var(--accent-color)] to-[var(--secondary-color)] bg-[length:400%_400%] animate-gradient;
  }
  
  .glass-effect {
    @apply bg-white/10 backdrop-blur-md;
  }
}

// tailwind.config.js
module.exports = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx}',
    './components/**/*.{js,ts,jsx,tsx}',
  ],
  theme: {
    extend: {
      fontFamily: {
        tajawal: ['Tajawal', 'sans-serif'],
      },
      animation: {
        gradient: 'gradient 15s ease infinite',
        float: 'float 6s ease-in-out infinite',
      },
      keyframes: {
        gradient: {
          '0%, 100%': { backgroundPosition: '0% 50%' },
          '50%': { backgroundPosition: '100% 50%' },
        },
        float: {
          '0%, 100%': { transform: 'translateY(0)' },
          '50%': { transform: 'translateY(-10px)' },
        },
      },
    },
  },
  plugins: [],
}

// components/LoginContainer.js
import { motion } from 'framer-motion'
import { Box, Heading, VStack } from '@chakra-ui/react'

export default function LoginContainer({ children }) {
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      className="relative w-full max-w-[500px] z-10"
    >
      <Box
        className="glass-effect rounded-[20px] p-10 text-center transform-gpu transition-all duration-300 hover:-translate-y-1 hover:rotate-x-3 hover:shadow-xl"
        boxShadow="0 8px 32px 0 rgba(31, 38, 135, 0.37)"
      >
        <VStack spacing={8}>
          <Heading
            as="h2"
            className="text-white text-4xl font-bold text-shadow-lg"
          >
            حاسبة تقسيط العمرة
          </Heading>
          {children}
        </VStack>
      </Box>
    </motion.div>
  )
}

// pages/index.js
import { Box } from '@chakra-ui/react'
import LoginContainer from '../components/LoginContainer'
import ParticlesBackground from '../components/ParticlesBackground'

export default function Home() {
  return (
    <Box className="min-h-screen flex flex-col justify-center items-center p-8 font-tajawal gradient-animate overflow-x-hidden relative">
      <ParticlesBackground />
      <LoginContainer>
        {/* محتوى الصفحة */}
      </LoginContainer>
    </Box>
  )
}

  // components/UserTypeButtons.js
import { motion } from 'framer-motion'
import { Button, HStack } from '@chakra-ui/react'

export const UserTypeButtons = ({ onCustomerClick, onAdminClick }) => {
  return (
    <HStack spacing={6} my={8} justify="center">
      <motion.div whileHover={{ y: -3 }}>
        <Button
          onClick={onCustomerClick}
          className="relative overflow-hidden bg-gradient-to-r from-primary to-secondary hover:shadow-xl"
          size="lg"
          fontSize="xl"
          px={8}
          py={6}
          _before={{
            content: '""',
            position: 'absolute',
            top: 0,
            left: '-100%',
            width: '100%',
            height: '100%',
            background: 'linear-gradient(120deg, transparent, rgba(255,255,255,0.3), transparent)',
            transition: '0.5s',
          }}
          _hover={{
            _before: {
              left: '100%',
            },
          }}
        >
          دخول كزبون
        </Button>
      </motion.div>

      <motion.div whileHover={{ y: -3 }}>
        <Button
          onClick={onAdminClick}
          className="relative overflow-hidden bg-gradient-to-r from-primary to-secondary hover:shadow-xl"
          size="lg"
          fontSize="xl"
          px={8}
          py={6}
          _before={{
            content: '""',
            position: 'absolute',
            top: 0,
            left: '-100%',
            width: '100%',
            height: '100%',
            background: 'linear-gradient(120deg, transparent, rgba(255,255,255,0.3), transparent)',
            transition: '0.5s',
          }}
          _hover={{
            _before: {
              left: '100%',
            },
          }}
        >
          دخول كمدير
        </Button>
      </motion.div>
    </HStack>
  )
}

// components/AdminLoginForm.js
import { motion, AnimatePresence } from 'framer-motion'
import { VStack, Input, Button, Box } from '@chakra-ui/react'

export const AdminLoginForm = ({ isVisible, onSubmit }) => {
  return (
    <AnimatePresence>
      {isVisible && (
        <motion.div
          initial={{ opacity: 0, y: -20 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: -20 }}
          transition={{ duration: 0.5 }}
        >
          <Box
            className="glass-effect rounded-xl mt-8 p-8"
            bgColor="whiteAlpha.200"
          >
            <VStack spacing={4}>
              <Input
                type="password"
                placeholder="أدخل كلمة المرور"
                maxW="300px"
                textAlign="center"
                fontSize="lg"
                borderWidth={2}
                borderColor="whiteAlpha.200"
                _focus={{
                  borderColor: 'primary.500',
                  boxShadow: '0 0 10px rgba(35, 166, 213, 0.3)',
                }}
                className="bg-white/10 text-white"
              />
              <Button
                onClick={onSubmit}
                bgColor="secondary.500"
                _hover={{
                  bgColor: 'primary.500',
                  transform: 'translateY(-2px)',
                }}
                size="lg"
                mt={4}
              >
                دخول
              </Button>
            </VStack>
          </Box>
        </motion.div>
      )}
    </AnimatePresence>
  )
}

// components/VisitorCounter.js
import { motion } from 'framer-motion'
import { Box, Text } from '@chakra-ui/react'

export const VisitorCounter = ({ count }) => {
  return (
    <motion.div
      initial={{ y: -50 }}
      animate={{ y: 0 }}
      className="fixed top-5 right-5 z-50"
    >
      <Box
        className="glass-effect px-6 py-3 rounded-full"
        bgColor="whiteAlpha.200"
        boxShadow="0 4px 6px rgba(0,0,0,0.1)"
      >
        <Text color="white" fontSize="xl">
          {count} زائر
        </Text>
      </Box>
    </motion.div>
  )
}

// tailwind.config.js
module.exports = {
  theme: {
    extend: {
      colors: {
        primary: '#23a6d5',
        secondary: '#23d5ab',
      },
      animation: {
        shine: 'shine 1s linear infinite',
      },
      keyframes: {
        shine: {
          '100%': { left: '100%' },
        },
      },
    },
  },
}
      // tailwind.config.js
module.exports = {
  theme: {
    extend: {
      keyframes: {
        bounce: {
          '0%, 100%': { transform: 'translateY(0)' },
          '50%': { transform: 'translateY(-10px)' },
        },
        slideIn: {
          from: { 
            opacity: '0',
            transform: 'translateY(-20px)',
          },
          to: { 
            opacity: '1',
            transform: 'translateY(0)',
          },
        },
        spin: {
          '0%': { transform: 'rotate(0deg)' },
          '100%': { transform: 'rotate(360deg)' },
        },
      },
      animation: {
        bounce: 'bounce 2s infinite',
        slideIn: 'slideIn 0.5s ease-out',
        spin: 'spin 1s linear infinite',
      },
    },
  },
}

// components/LoadingSpinner.js
import { motion } from 'framer-motion'

export const LoadingSpinner = ({ isLoading }) => {
  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: isLoading ? 1 : 0 }}
      className={`
        w-10 h-10 
        border-4 border-gray-200 
        border-t-primary 
        rounded-full 
        animate-spin 
        mx-auto my-5
        ${isLoading ? 'block' : 'hidden'}
      `}
    />
  )
}

// components/ResponsiveLayout.js
import { motion } from 'framer-motion'

export const ResponsiveLayout = ({ children }) => {
  return (
    <div className="p-4 sm:p-8">
      <motion.div 
        className="
          w-full max-w-md 
          mx-auto 
          p-6 sm:p-10 
          m-4
          bg-white/10 
          backdrop-blur-md 
          rounded-2xl
          shadow-xl
        "
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
      >
        {children}
      </motion.div>
    </div>
  )
}

// components/UserTypeButtons.js
import { motion } from 'framer-motion'

export const UserTypeButtons = () => {
  return (
    <div className="flex flex-col sm:flex-row justify-center gap-6 my-8">
      <motion.button
        whileHover={{ y: -3 }}
        className="w-full sm:w-auto px-8 py-4 rounded-xl bg-gradient-to-r from-primary to-secondary"
      >
        دخول كزبون
      </motion.button>
      <motion.button
        whileHover={{ y: -3 }}
        className="w-full sm:w-auto px-8 py-4 rounded-xl bg-gradient-to-r from-primary to-secondary"
      >
        دخول كمدير
      </motion.button>
    </div>
  )
}

// components/VisitorCounter.js
import { motion } from 'framer-motion'

export const VisitorCounter = ({ count }) => {
  return (
    <motion.div
      initial={{ y: -50 }}
      animate={{ y: 0 }}
      className="
        fixed top-2.5 right-2.5 sm:top-5 sm:right-5
        px-4 py-2 sm:px-5 sm:py-3
        text-sm sm:text-lg
        bg-white/20 
        backdrop-blur-sm 
        rounded-full 
        text-white 
        shadow-lg
        animate-bounce
      "
    >
      {count} زائر
    </motion.div>
  )
}

// styles/globals.css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer utilities {
  @media (prefers-reduced-motion: reduce) {
    * {
      @apply animate-none transition-none;
    }
  }
}
    </style>
        
// pages/index.js
import { motion } from 'framer-motion'
import { Box, Button, Input, VStack, Heading, Text, Icon } from '@chakra-ui/react'
import { FaUser, FaUserShield } from 'react-icons/fa'
import ParticlesBackground from '../components/ParticlesBackground'
import LoadingSpinner from '../components/LoadingSpinner'
import VisitorCounter from '../components/VisitorCounter'

export default function Home() {
  return (
    <Box className="min-h-screen relative flex flex-col items-center justify-center p-4 sm:p-8">
      <ParticlesBackground />
      <LoadingSpinner />
      <VisitorCounter />

      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        className="w-full max-w-lg relative z-10"
      >
        <Box
          className="glass-effect rounded-3xl p-8 sm:p-10 text-center"
          bg="whiteAlpha.100"
          backdropFilter="blur(10px)"
        >
          <motion.div
            initial={{ y: -20 }}
            animate={{ y: 0 }}
            transition={{ duration: 0.5 }}
          >
            <Heading
              as="h2"
              size="xl"
              color="white"
              className="mb-8 text-shadow"
            >
              حاسبة تقسيط العمرة
            </Heading>
          </motion.div>

          <VStack spacing={6} className="user-type-buttons">
            <motion.div
              className="w-full"
              whileHover={{ y: -3 }}
              initial={{ x: -50, opacity: 0 }}
              animate={{ x: 0, opacity: 1 }}
            >
              <Button
                leftIcon={<Icon as={FaUser} />}
                onClick={() => redirectToCustomer()}
                className="w-full bg-gradient-primary hover:shadow-lg"
                size="lg"
                colorScheme="blue"
              >
                دخول كزبون
              </Button>
            </motion.div>

            <motion.div
              className="w-full"
              whileHover={{ y: -3 }}
              initial={{ x: 50, opacity: 0 }}
              animate={{ x: 0, opacity: 1 }}
            >
              <Button
                leftIcon={<Icon as={FaUserShield} />}
                onClick={() => showAdminLogin()}
                className="w-full bg-gradient-secondary hover:shadow-lg"
                size="lg"
                colorScheme="teal"
              >
                دخول كمدير
              </Button>
            </motion.div>
          </VStack>

          <motion.div
            initial={{ opacity: 0, height: 0 }}
            animate={isAdminLoginVisible ? { 
              opacity: 1, 
              height: 'auto' 
            } : { 
              opacity: 0, 
              height: 0 
            }}
            className="mt-8"
          >
            <Box
              className="bg-white/20 rounded-xl p-6"
            >
              <Heading as="h3" size="md" color="white" mb={4}>
                تسجيل دخول المدير
              </Heading>
              <VStack spacing={4}>
                <Input
                  type="password"
                  id="adminPassword"
                  placeholder="أدخل كلمة المرور"
                  bg="whiteAlpha.200"
                  color="white"
                  _placeholder={{ color: 'whiteAlpha.700' }}
                  _focus={{
                    borderColor: 'blue.400',
                    boxShadow: '0 0 0 1px blue.400',
                  }}
                />
                <Button
                  onClick={() => checkAdminPassword()}
                  colorScheme="blue"
                  width="full"
                >
                  دخول
                </Button>
              </VStack>
            </Box>
          </motion.div>
        </Box>
      </motion.div>
    </Box>
  )
}

// components/ParticlesBackground.js
export const ParticlesBackground = () => {
  return (
    <div id="particles-js" className="absolute inset-0 z-0" />
  )
}

// components/LoadingSpinner.js
export const LoadingSpinner = () => {
  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: isLoading ? 1 : 0 }}
      className="w-10 h-10 border-4 border-blue-200 border-t-blue-500 rounded-full animate-spin m-5"
    />
  )
}

// components/VisitorCounter.js
export const VisitorCounter = ({ count }) => {
  return (
    <motion.div
      initial={{ y: -50 }}
      animate={{ y: 0 }}
      className="fixed top-5 right-5 bg-white/20 backdrop-blur px-6 py-3 rounded-full text-white text-lg shadow-lg z-50"
    >
      <Text>{count} زائر</Text>
    </motion.div>
  )
}

 // pages/_app.js
import { ChakraProvider } from '@chakra-ui/react'
import { initializeApp } from 'firebase/app'
import { getDatabase } from 'firebase/database'
import { AnimatePresence } from 'framer-motion'

    <script>
       
              // تكوين Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDEQLPyt8Wp0oA5pvgKz93dczqYsBNDpvY",
            authDomain: "omrati-453e1.firebaseapp.com",
            databaseURL: "https://omrati-453e1-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "omrati-453e1",
            storageBucket: "omrati-453e1.appspot.com",
            messagingSenderId: "211184940647",
            appId: "1:211184940647:web:865a3a9810d8b45faf06c2",
            measurementId: "G-RM7T583FYY"
        };


// Initialize Firebase
const app = initializeApp(firebaseConfig)
const database = getDatabase(app)

function MyApp({ Component, pageProps }) {
  return (
    <ChakraProvider>
      <AnimatePresence mode="wait">
        <Component {...pageProps} />
      </AnimatePresence>
    </ChakraProvider>
  )
}

export default MyApp

// components/ParticlesBackground.js
import { useCallback } from 'react'
import Particles from 'react-tsparticles'
import { loadFull } from 'tsparticles'

export default function ParticlesBackground() {
  const particlesInit = useCallback(async (engine) => {
    await loadFull(engine)
  }, [])

  const particlesConfig = {
    particles: {
      number: {
        value: 80,
        density: {
          enable: true,
          value_area: 800
        }
      },
      color: {
        value: '#ffffff'
      },
      shape: {
        type: 'circle'
      },
      opacity: {
        value: 0.5,
        random: false,
        anim: {
          enable: false
        }
      },
      size: {
        value: 3,
        random: true
      },
      line_linked: {
        enable: true,
        distance: 150,
        color: '#ffffff',
        opacity: 0.4,
        width: 1
      },
      move: {
        enable: true,
        speed: 6,
        direction: 'none',
        random: false,
        straight: false,
        out_mode: 'out',
        bounce: false
      }
    },
    interactivity: {
      detect_on: 'canvas',
      events: {
        onhover: {
          enable: true,
          mode: 'repulse'
        },
        onclick: {
          enable: true,
          mode: 'push'
        },
        resize: true
      }
    },
    retina_detect: true
  }

  return (
    <Particles
      id="particles-bg"
      init={particlesInit}
      options={particlesConfig}
      className="absolute inset-0"
    />
  )
}

// utils/firebase.js
import { ref, onValue, runTransaction } from 'firebase/database'
import { database } from './firebaseConfig'

export const incrementVisitorCount = () => {
  const visitorId = localStorage.getItem('visitorId')
  if (!visitorId) {
    const newVisitorId = Date.now().toString()
    localStorage.setItem('visitorId', newVisitorId)
    
    const visitorRef = ref(database, 'visitorCount')
    runTransaction(visitorRef, (currentCount) => {
      return (currentCount || 0) + 1
    })
  }
}

export const useVisitorCount = (callback) => {
  const visitorRef = ref(database, 'visitorCount')
  onValue(visitorRef, (snapshot) => {
    const count = snapshot.val() || 0
    callback(count)
  })
}

// hooks/useAuth.js
import { useState } from 'react'
import { useToast } from '@chakra-ui/react'
import { useRouter } from 'next/router'

export const useAuth = () => {
  const [loading, setLoading] = useState(false)
  const toast = useToast()
  const router = useRouter()

  const checkAdminPassword = async (password) => {
    setLoading(true)
    try {
      if (password === process.env.NEXT_PUBLIC_ADMIN_PASSWORD) {
        toast({
          title: 'تم تسجيل الدخول بنجاح',
          status: 'success',
          duration: 1500
        })
        sessionStorage.setItem('adminLoggedIn', 'true')
        router.push('/admin')
      } else {
        toast({
          title: 'خطأ في تسجيل الدخول',
          description: 'كلمة المرور غير صحيحة',
          status: 'error'
        })
      }
    } catch (error) {
      console.error(error)
      toast({
        title: 'حدث خطأ',
        description: 'يرجى المحاولة مرة أخرى',
        status: 'error'
      })
    } finally {
      setLoading(false)
    }
  }

  return { loading, checkAdminPassword }
}
       // hooks/useLoading.js
import { atom, useAtom } from 'jotai'

const loadingAtom = atom(false)

export const useLoading = () => {
  const [isLoading, setIsLoading] = useAtom(loadingAtom)
  
  const showLoading = () => setIsLoading(true)
  const hideLoading = () => setIsLoading(false)
  
  return { isLoading, showLoading, hideLoading }
}

// components/LoadingSpinner.js
import { motion, AnimatePresence } from 'framer-motion'
import { useLoading } from '@/hooks/useLoading'

export const LoadingSpinner = () => {
  const { isLoading } = useLoading()
  
  return (
    <AnimatePresence>
      {isLoading && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="w-10 h-10 border-4 border-blue-200 border-t-blue-500 rounded-full animate-spin mx-auto my-5"
        />
      )}
    </AnimatePresence>
  )
}

// hooks/useAuth.js
import { useState } from 'react'
import { useRouter } from 'next/router'
import { useToast } from '@chakra-ui/react'
import { useLoading } from './useLoading'

export const useAuth = () => {
  const router = useRouter()
  const toast = useToast()
  const { showLoading, hideLoading } = useLoading()
  const [isAdminFormVisible, setIsAdminFormVisible] = useState(false)

  const redirectToCustomer = async () => {
    showLoading()
    toast({
      title: 'جاري التحميل...',
      description: 'سيتم توجيهك إلى صفحة الزبون',
      status: 'info',
      duration: 2000,
      isClosable: false,
    })
    
    setTimeout(() => {
      router.push('/customer')
    }, 2000)
  }

  const showAdminLogin = () => {
    setIsAdminFormVisible(true)
  }

  const checkAdminPassword = async (password) => {
    showLoading()
    
    try {
      if (password === process.env.NEXT_PUBLIC_ADMIN_PASSWORD) {
        toast({
          title: 'تم تسجيل الدخول بنجاح',
          description: 'جاري توجيهك إلى لوحة التحكم',
          status: 'success',
          duration: 1500,
        })
        
        sessionStorage.setItem('adminLoggedIn', 'true')
        setTimeout(() => {
          router.push('/admin')
        }, 1500)
      } else {
        hideLoading()
        toast({
          title: 'خطأ في تسجيل الدخول',
          description: 'كلمة المرور غير صحيحة',
          status: 'error',
          duration: 3000,
          isClosable: true,
        })
      }
    } catch (error) {
      console.error(error)
      hideLoading()
      toast({
        title: 'حدث خطأ',
        description: 'يرجى المحاولة مرة أخرى',
        status: 'error',
        duration: 3000,
      })
    }
  }

  return {
    isAdminFormVisible,
    redirectToCustomer,
    showAdminLogin,
    checkAdminPassword,
  }
}

// components/AdminLoginForm.js
import { useState } from 'react'
import { motion } from 'framer-motion'
import { Input, Button, VStack, Heading } from '@chakra-ui/react'
import { useAuth } from '@/hooks/useAuth'

export const AdminLoginForm = () => {
  const [password, setPassword] = useState('')
  const { isAdminFormVisible, checkAdminPassword } = useAuth()

  const handleSubmit = (e) => {
    e.preventDefault()
    checkAdminPassword(password)
    setPassword('')
  }

  return (
    <motion.div
      initial={{ opacity: 0, height: 0 }}
      animate={{ 
        opacity: isAdminFormVisible ? 1 : 0,
        height: isAdminFormVisible ? 'auto' : 0
      }}
      transition={{ duration: 0.5 }}
    >
      <form onSubmit={handleSubmit} className="bg-white/20 rounded-xl p-6 mt-8">
        <VStack spacing={4}>
          <Heading as="h3" size="md" color="white">
            تسجيل دخول المدير
          </Heading>
          <Input
            type="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            placeholder="أدخل كلمة المرور"
            bg="whiteAlpha.200"
            color="white"
            _placeholder={{ color: 'whiteAlpha.700' }}
          />
          <Button
            type="submit"
            colorScheme="blue"
            width="full"
          >
            دخول
          </Button>
        </VStack>
      </form>
    </motion.div>
  )
}

      // hooks/useVisitorCount.js
import { useState, useEffect } from 'react'
import { ref, onValue, runTransaction } from 'firebase/database'
import { database } from '@/lib/firebase'
import { motion, useMotionValue, useTransform, animate } from 'framer-motion'

export const useVisitorCount = () => {
  const [count, setCount] = useState(0)
  const countMotion = useMotionValue(0)
  
  const roundedCount = useTransform(countMotion, latest => Math.round(latest))

  useEffect(() => {
    const incrementCount = async () => {
      const visitorId = localStorage.getItem('visitorId')
      if (!visitorId) {
        const newVisitorId = Date.now().toString()
        localStorage.setItem('visitorId', newVisitorId)
        
        const visitorRef = ref(database, 'visitorCount')
        await runTransaction(visitorRef, (currentCount) => {
          return (currentCount || 0) + 1
        })
      }
    }

    const listenToCount = () => {
      const visitorRef = ref(database, 'visitorCount')
      return onValue(visitorRef, (snapshot) => {
        const newCount = snapshot.val() || 0
        setCount(newCount)
        animate(countMotion, newCount, {
          duration: 2,
          ease: 'easeOut'
        })
      })
    }

    incrementCount()
    const unsubscribe = listenToCount()

    return () => unsubscribe()
  }, [])

  return { count, roundedCount }
}

// components/VisitorCounter.js
import { motion } from 'framer-motion'
import { useVisitorCount } from '@/hooks/useVisitorCount'

export const VisitorCounter = () => {
  const { roundedCount } = useVisitorCount()

  return (
    <motion.div
      initial={{ y: -50, opacity: 0 }}
      animate={{ y: 0, opacity: 1 }}
      className="fixed top-5 right-5 bg-white/20 backdrop-blur-sm px-6 py-3 rounded-full text-white text-xl shadow-lg z-50"
    >
      <motion.span>{roundedCount}</motion.span> زائر
    </motion.div>
  )
}

// lib/errorBoundary.js
import { Component } from 'react'
import { ErrorBoundary } from 'react-error-boundary'
import { Button, Text, VStack } from '@chakra-ui/react'

function ErrorFallback({ error, resetErrorBoundary }) {
  return (
    <VStack spacing={4} p={8} align="center">
      <Text color="red.500">حدث خطأ غير متوقع</Text>
      <Text fontSize="sm">{error.message}</Text>
      <Button onClick={resetErrorBoundary} colorScheme="blue">
        حاول مرة أخرى
      </Button>
    </VStack>
  )
}

export const AppErrorBoundary = ({ children }) => (
  <ErrorBoundary FallbackComponent={ErrorFallback}>
    {children}
  </ErrorBoundary>
)

// pages/_app.js
import { useEffect } from 'react'
import { ChakraProvider } from '@chakra-ui/react'
import { AppErrorBoundary } from '@/lib/errorBoundary'

function MyApp({ Component, pageProps }) {
  useEffect(() => {
    // Performance optimization
    const optimizeStyles = () => {
      const styleSheets = document.querySelectorAll('link[rel="stylesheet"]')
      styleSheets.forEach(sheet => {
        sheet.media = 'all'
      })
    }

    // Service worker registration
    const registerServiceWorker = async () => {
      if ('serviceWorker' in navigator) {
        try {
          await navigator.serviceWorker.register('/sw.js')
          console.log('ServiceWorker registration successful')
        } catch (err) {
          console.error('ServiceWorker registration failed:', err)
        }
      }
    }

    window.addEventListener('load', () => {
      setTimeout(optimizeStyles, 0)
      registerServiceWorker()
    })
  }, [])

  return (
    <ChakraProvider>
      <AppErrorBoundary>
        <Component {...pageProps} />
      </AppErrorBoundary>
    </ChakraProvider>
  )
}

export default MyApp

// components/AdminLogin.js
import { useRef } from 'react'
import { Input } from '@chakra-ui/react'
import { useAuth } from '@/hooks/useAuth'

export const AdminLogin = () => {
  const inputRef = useRef()
  const { checkAdminPassword } = useAuth()

  const handleKeyPress = (event) => {
    if (event.key === 'Enter') {
      checkAdminPassword(inputRef.current.value)
    }
  }

  return (
    <Input
      ref={inputRef}
      type="password"
      onKeyPress={handleKeyPress}
      placeholder="أدخل كلمة المرور"
    />
  )
}

            </script>
</body>
</html>
